<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    Admin Panel
  </title>
  <link rel="shortcut icon" href="/images/logo-mb.png" type="image/png">
  <!-- GOOGLE FONT -->
  <link rel="preconnect" href="https://fonts.gstatic.com">

  <!-- BOXICONS -->
  <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <!-- MDB -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.3.0/mdb.min.css" rel="stylesheet" />
  <!-- APP CSS -->
  <link rel="stylesheet" href="/styles/grid.css">
  <link rel="stylesheet" href="/styles/dashboard.css">
  <link rel="stylesheet" href="/styles/custom_user.css">
  <link rel="stylesheet" href="/styles/alert.css">
</head>

<body id="body">

  <style>
    #loading-spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      height: 100%;
      translate: (-50%, -50%);
    }
  </style>
  <div id="loading-spinner" style="display:none;">
    <img src="/images/spinner.gif" alt="Loading...">
  </div>
  <div class="main-content py-2 container-fluid py-4">
    <div class="my-2 text-light">
      <a class="text-light btn btn-primary" href="/combined-question/view-subject?class_id=<%= filter.class_id %>&subject=<%= filter.subject %>&q_set=<%= filter.q_set %>&q_formate=<%= filter.q_formate %>">Subject List</a>
      <a class="text-light btn btn-success" href="/combined-question/view-set?q_set_id=<%= filter.q_set  %>">View Question Preview</a>
    </div>
    <% if(questions.length == 0){ %>
    <p>no question</p>
    <% }else{ %>
    <div class="table-responsive table-nowrap">

    </div>
    <table class="table">
      <thead class="table-dark">
        <tr>
          <th scope="col">SL</th>
          <th scope="col">Question</th>
          <th scope="col">Opt1</th>
          <th scope="col">Opt2</th>
          <th scope="col">Opt3</th>
          <th scope="col">Opt4</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <% for(let i=0; i<questions.length; i++){ %>
        <% let opt = JSON.parse(questions[i].question_option) %>
        <input type="text" class="q_id" value="<%= questions[i].id %>" hidden>
        <tr>
          <th><%= i+1 %></th>
          <td><button class="btn btn-sm border border-dark add_btn">Add</button></td>
          <td><%- questions[i].question_text %></td>
          <td><%- opt[0] %></td>
          <td><%- opt[1] %></td>
          <td><%- opt[2] %></td>
          <td><%- opt[3] %></td>
        </tr>
        <% } %>
      </tbody>
    </table>

    <% } %>

    <%- include('../partials/footer.ejs') %>

    <script>
      let add_btn = document.getElementsByClassName('add_btn')
      let q_id = document.getElementsByClassName('q_id')
      for (let i = 0; i < add_btn.length; i++) {
        add_btn[i].addEventListener('click', () => {
          console.log(q_id[i].value);
          fetch(`/combined-question/add-question?q_id=${q_id[i].value}&q_set=<%=filter.q_set%>`)
            .then(res => res.json())
            .then(data => {
              if (data.status === 200) {
                add_btn[i].innerText = 'added'
                add_btn[i].classList.add('btn-success')
              } else if (data.status === 400) {
                add_btn[i].innerText = 'already added'
                add_btn[i].classList.add('btn-danger')
              }
            })
        })
      }
    </script>

</body>

</html>